import"./el-popper-BJ9IAnsw.js";import{j as x,k as C,E,l as g,m as _}from"./ImageInfo-DDmLfvN2.js";import{d as V,g as d,b as N,l as A,e as c,o as u,E as t,G as f,J as B,w as S,F as y,K as b,c as T,H as o,_ as $}from"./index-DvnR32jn.js";const L={class:"image-grid"},M=["src","alt"],j={class:"image-info"},R={class:"name"},U={class:"type"},G={class:"filename"},H={class:"date"},J=["onClick"],K=V({__name:"ImageManage",setup(O){const n=d(""),r=d(""),s=d(null),m=d([]),w=N(()=>x.filter(a=>a!=="全部")),p=async()=>{try{m.value=await g.images.toArray()}catch(a){console.error("加载图片失败:",a)}},k=a=>new Date(a).toLocaleDateString(),I=a=>{const e=a.target;e.files&&e.files[0]&&(s.value=e.files[0])},D=a=>a.split(".").slice(0,-1).join(".")||a,h=async()=>{if(!s.value){n.value="请选择图片文件";return}if(!r.value){n.value="请选择图片类型";return}try{const a=new FileReader;a.onload=async e=>{const v=e.target?.result,i=D(s.value?.name||"未命名图片");await g.images.add({name:i,type:r.value,data:v,filename:s.value?.name||"",uploadedAt:new Date}),n.value=`图片 ${i} 添加成功`,r.value="",s.value=null,await p(),await _()},a.readAsDataURL(s.value)}catch(a){n.value=`添加图片失败: ${a}`}},F=async a=>{try{await g.images.delete(a),await p(),await _(),n.value="图片删除成功"}catch(e){n.value=`删除图片失败: ${e}`}};return A(()=>{p()}),(a,e)=>{const v=C,i=E;return u(),c("div",null,[t("fieldset",null,[e[3]||(e[3]=t("legend",null,"添加新图片",-1)),t("label",null,[e[1]||(e[1]=f(" 类型: ",-1)),B(i,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),clearable:"",placeholder:"请选择图片类型"},{default:S(()=>[(u(!0),c(y,null,b(w.value,l=>(u(),T(v,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e[4]||(e[4]=t("br",null,null,-1)),t("label",null,[e[2]||(e[2]=f(" 图片文件: ",-1)),t("input",{type:"file",onChange:I,accept:"image/*"},null,32)]),e[5]||(e[5]=t("br",null,null,-1)),t("button",{onClick:h},"添加图片"),t("p",null,o(n.value),1)]),t("h2",null,"图片列表 ("+o(m.value.length)+"张)",1),t("div",L,[(u(!0),c(y,null,b(m.value,l=>(u(),c("div",{key:l.id,class:"image-item"},[t("img",{src:l.data,alt:l.name,class:"image-preview"},null,8,M),t("div",j,[t("span",R,o(l.name),1),t("span",U,o(l.type),1),t("span",G,o(l.filename),1),t("span",H,o(k(l.uploadedAt)),1)]),t("button",{onClick:W=>F(l.id)},"删除",8,J)]))),128))])])}}}),Q=$(K,[["__scopeId","data-v-e44da958"]]);export{Q as default};
