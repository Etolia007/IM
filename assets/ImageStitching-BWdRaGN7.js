import{b as ie,x as be,s as J,_ as pe,u as re,J as Ne,w as _e,P as Se,m as je,K as $e,L as nt,g as Ae,M as st,N as Te,O as at,d as it,Q as He,h as Fe,c as rt,R as ct,r as ut,S as dt,U as ze,V as ft,k as Ve,W as vt,X as mt,Y as gt,Z as pt,$ as yt}from"./el-popper-BCmEIes6.js";import{E as ht,a as bt,b as Ye}from"./el-checkbox-ByuKjw1h.js";import{u as _t,U as Ke,g as Ct,a as We,b as Xe,l as kt,c as wt,I as Re,E as It,d as Et,e as St,f as Lt,i as ve}from"./ImageInfo-CZBf7B4F.js";import{d as B,i as Pe,b as S,B as qe,c as X,o as b,w as y,r as V,f as Ce,n as A,u as s,I as Ie,N as Le,J as h,s as $t,g as L,l as we,C as Tt,q as Pt,M as Me,e as T,E as k,O as Z,H as me,P as Mt,j as ge,Q as Dt,k as Ot,A as At,z as Ge,a as Bt,T as Nt,m as xe,x as Ft,R as zt,y as Vt,p as Je,h as Rt,S as Ze,F as De,K as Oe,_ as Qe,G,U as xt}from"./index-CeFfmvpR.js";const Ut=ie({tag:{type:String,default:"div"},span:{type:Number,default:24},offset:{type:Number,default:0},pull:{type:Number,default:0},push:{type:Number,default:0},xs:{type:J([Number,Object]),default:()=>be({})},sm:{type:J([Number,Object]),default:()=>be({})},md:{type:J([Number,Object]),default:()=>be({})},lg:{type:J([Number,Object]),default:()=>be({})},xl:{type:J([Number,Object]),default:()=>be({})}}),et=Symbol("rowContextKey"),jt=B({name:"ElCol"}),Ht=B({...jt,props:Ut,setup(t){const a=t,{gutter:l}=Pe(et,{gutter:S(()=>0)}),f=re("col"),o=S(()=>{const n={};return l.value&&(n.paddingLeft=n.paddingRight=`${l.value/2}px`),n}),d=S(()=>{const n=[];return["span","offset","pull","push"].forEach(v=>{const C=a[v];Ne(C)&&(v==="span"?n.push(f.b(`${a[v]}`)):C>0&&n.push(f.b(`${v}-${a[v]}`)))}),["xs","sm","md","lg","xl"].forEach(v=>{Ne(a[v])?n.push(f.b(`${v}-${a[v]}`)):qe(a[v])&&Object.entries(a[v]).forEach(([C,P])=>{n.push(C!=="span"?f.b(`${v}-${C}-${P}`):f.b(`${v}-${P}`))})}),l.value&&n.push(f.is("guttered")),[f.b(),n]});return(n,w)=>(b(),X(Ie(n.tag),{class:A(s(d)),style:Ce(s(o))},{default:y(()=>[V(n.$slots,"default")]),_:3},8,["class","style"]))}});var Yt=pe(Ht,[["__file","col.vue"]]);const Kt=_e(Yt),tt=t=>{if(!t)return{onClick:Le,onMousedown:Le,onMouseup:Le};let a=!1,l=!1;return{onClick:n=>{a&&l&&t(n),a=l=!1},onMousedown:n=>{a=n.target===n.currentTarget},onMouseup:n=>{l=n.target===n.currentTarget}}},Wt=ie({mask:{type:Boolean,default:!0},customMaskEvent:Boolean,overlayClass:{type:J([String,Array,Object])},zIndex:{type:J([String,Number])}}),Xt={click:t=>t instanceof MouseEvent},qt="overlay";var Gt=B({name:"ElOverlay",props:Wt,emits:Xt,setup(t,{slots:a,emit:l}){const f=re(qt),o=r=>{l("click",r)},{onClick:d,onMousedown:n,onMouseup:w}=tt(t.customMaskEvent?void 0:o);return()=>t.mask?h("div",{class:[f.b(),t.overlayClass],style:{zIndex:t.zIndex},onClick:d,onMousedown:n,onMouseup:w},[V(a,"default")],Se.STYLE|Se.CLASS|Se.PROPS,["onClick","onMouseup","onMousedown"]):$t("div",{class:t.overlayClass,style:{zIndex:t.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[V(a,"default")])}});const Jt=Gt,lt=Symbol("dialogInjectionKey"),Ue="dialog-fade",ot=ie({center:Boolean,alignCenter:{type:Boolean,default:void 0},closeIcon:{type:je},draggable:{type:Boolean,default:void 0},overflow:{type:Boolean,default:void 0},fullscreen:Boolean,headerClass:String,bodyClass:String,footerClass:String,showClose:{type:Boolean,default:!0},title:{type:String,default:""},ariaLevel:{type:String,default:"2"}}),Zt={close:()=>!0},Qt=(t,a,l,f)=>{const o={offsetX:0,offsetY:0},d=L(!1),n=(_,u)=>{if(t.value){const{offsetX:O,offsetY:R}=o,N=t.value.getBoundingClientRect(),D=N.left,E=N.top,x=N.width,j=N.height,H=document.documentElement.clientWidth,te=document.documentElement.clientHeight,Q=-D+O,Y=-E+R,F=H-D-x+O,ee=te-E-(j<te?j:0)+R;f?.value||(_=Math.min(Math.max(_,Q),F),u=Math.min(Math.max(u,Y),ee)),o.offsetX=_,o.offsetY=u,t.value.style.transform=`translate(${$e(_)}, ${$e(u)})`}},w=_=>{const u=_.clientX,O=_.clientY,{offsetX:R,offsetY:N}=o,D=x=>{d.value||(d.value=!0);const j=R+x.clientX-u,H=N+x.clientY-O;n(j,H)},E=()=>{d.value=!1,document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",E)};document.addEventListener("mousemove",D),document.addEventListener("mouseup",E)},r=()=>{a.value&&t.value&&(a.value.addEventListener("mousedown",w),window.addEventListener("resize",P))},v=()=>{a.value&&t.value&&(a.value.removeEventListener("mousedown",w),window.removeEventListener("resize",P))},C=()=>{o.offsetX=0,o.offsetY=0,t.value&&(t.value.style.transform="")},P=()=>{const{offsetX:_,offsetY:u}=o;n(_,u)};return we(()=>{Tt(()=>{l.value?r():v()})}),Pt(()=>{v()}),{isDragging:d,resetPosition:C,updatePosition:P}},el=(...t)=>a=>{t.forEach(l=>{Me(l)?l(a):l.value=a})},tl=B({name:"ElDialogContent"}),ll=B({...tl,props:ot,emits:Zt,setup(t,{expose:a}){const l=t,{t:f}=_t(),{Close:o}=nt,{dialogRef:d,headerRef:n,bodyId:w,ns:r,style:v}=Pe(lt),{focusTrapRef:C}=Pe(st),P=el(C,d),_=S(()=>!!l.draggable),u=S(()=>!!l.overflow),{resetPosition:O,updatePosition:R,isDragging:N}=Qt(d,n,_,u),D=S(()=>[r.b(),r.is("fullscreen",l.fullscreen),r.is("draggable",_.value),r.is("dragging",N.value),r.is("align-center",!!l.alignCenter),{[r.m("center")]:l.center}]);return a({resetPosition:O,updatePosition:R}),(E,x)=>(b(),T("div",{ref:s(P),class:A(s(D)),style:Ce(s(v)),tabindex:"-1"},[k("header",{ref_key:"headerRef",ref:n,class:A([s(r).e("header"),E.headerClass,{"show-close":E.showClose}])},[V(E.$slots,"header",{},()=>[k("span",{role:"heading","aria-level":E.ariaLevel,class:A(s(r).e("title"))},me(E.title),11,["aria-level"])]),E.showClose?(b(),T("button",{key:0,"aria-label":s(f)("el.dialog.close"),class:A(s(r).e("headerbtn")),type:"button",onClick:j=>E.$emit("close")},[h(s(Ae),{class:A(s(r).e("close"))},{default:y(()=>[(b(),X(Ie(E.closeIcon||s(o))))]),_:1},8,["class"])],10,["aria-label","onClick"])):Z("v-if",!0)],2),k("div",{id:s(w),class:A([s(r).e("body"),E.bodyClass])},[V(E.$slots,"default")],10,["id"]),E.$slots.footer?(b(),T("footer",{key:0,class:A([s(r).e("footer"),E.footerClass])},[V(E.$slots,"footer")],2)):Z("v-if",!0)],6))}});var ol=pe(ll,[["__file","dialog-content.vue"]]);const nl=ie({...ot,appendToBody:Boolean,appendTo:{type:at.to.type,default:"body"},beforeClose:{type:J(Function)},destroyOnClose:Boolean,closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},modalPenetrable:Boolean,openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:Boolean,modalClass:String,headerClass:String,bodyClass:String,footerClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:Boolean,headerAriaLevel:{type:String,default:"2"},transition:{type:J([String,Object]),default:void 0}}),sl={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[Ke]:t=>Te(t),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},al=(t,a={})=>{Mt(t)||it("[useLockscreen]","You need to pass a ref param to this function");const l=a.ns||re("popup"),f=S(()=>l.bm("parent","hidden"));if(!He||Fe(document.body,f.value))return;let o=0,d=!1,n="0";const w=()=>{setTimeout(()=>{typeof document>"u"||d&&document&&(document.body.style.width=n,ut(document.body,f.value))},200)};ge(t,r=>{if(!r){w();return}d=!Fe(document.body,f.value),d&&(n=document.body.style.width,rt(document.body,f.value)),o=Ct(l.namespace.value);const v=document.documentElement.clientHeight<document.body.scrollHeight,C=ct(document.body,"overflowY");o>0&&(v||C==="scroll")&&d&&(document.body.style.width=`calc(100% - ${o}px)`)}),Dt(()=>w())},il=(t,a)=>{var l;const o=Ot().emit,{nextZIndex:d}=dt();let n="";const w=ze(),r=ze(),v=L(!1),C=L(!1),P=L(!1),_=L((l=t.zIndex)!=null?l:d());let u,O;const R=We(),N=S(()=>{var i,p;return(p=(i=R.value)==null?void 0:i.namespace)!=null?p:ft}),D=S(()=>{var i;return(i=R.value)==null?void 0:i.dialog}),E=S(()=>{const i={},p=`--${N.value}-dialog`;return t.fullscreen||(t.top&&(i[`${p}-margin-top`]=t.top),t.width&&(i[`${p}-width`]=$e(t.width))),i}),x=S(()=>{var i,p,M;return((M=(p=t.draggable)!=null?p:(i=D.value)==null?void 0:i.draggable)!=null?M:!1)&&!t.fullscreen}),j=S(()=>{var i,p,M;return(M=(p=t.alignCenter)!=null?p:(i=D.value)==null?void 0:i.alignCenter)!=null?M:!1}),H=S(()=>{var i,p,M;return(M=(p=t.overflow)!=null?p:(i=D.value)==null?void 0:i.overflow)!=null?M:!1}),te=S(()=>j.value?{display:"flex"}:{}),Q=S(()=>{var i,p,M;const ae=(M=(p=t.transition)!=null?p:(i=D.value)==null?void 0:i.transition)!=null?M:Ue,he={name:ae,onAfterEnter:Y,onBeforeLeave:ee,onAfterLeave:F};if(qe(ae)){const z={...ae},K=(U,I)=>q=>{At(U)?U.forEach(le=>{Me(le)&&le(q)}):Me(U)&&U(q),I()};return z.onAfterEnter=K(z.onAfterEnter,Y),z.onBeforeLeave=K(z.onBeforeLeave,ee),z.onAfterLeave=K(z.onAfterLeave,F),z.name||(z.name=Ue),z}return he});function Y(){o("opened")}function F(){o("closed"),o(Ke,!1),t.destroyOnClose&&(P.value=!1)}function ee(){o("close")}function ce(){O?.(),u?.(),t.openDelay&&t.openDelay>0?{stop:u}=Ve(()=>ke(),t.openDelay):ke()}function m(){u?.(),O?.(),t.closeDelay&&t.closeDelay>0?{stop:O}=Ve(()=>ye(),t.closeDelay):ye()}function ue(){function i(p){p||(C.value=!0,v.value=!1)}t.beforeClose?t.beforeClose(i):m()}function de(){t.closeOnClickModal&&ue()}function ke(){He&&(v.value=!0)}function ye(){v.value=!1}function Ee(){o("openAutoFocus")}function c(){o("closeAutoFocus")}function e(i){var p;((p=i.detail)==null?void 0:p.focusReason)==="pointer"&&i.preventDefault()}t.lockScroll&&al(v);function g(){t.closeOnPressEscape&&ue()}return ge(()=>t.zIndex,()=>{var i;_.value=(i=t.zIndex)!=null?i:d()}),ge(()=>t.modelValue,i=>{var p;i?(C.value=!1,ce(),P.value=!0,_.value=(p=t.zIndex)!=null?p:d(),Ge(()=>{o("open"),a.value&&(a.value.parentElement.scrollTop=0,a.value.parentElement.scrollLeft=0,a.value.scrollTop=0)})):v.value&&m()}),ge(()=>t.fullscreen,i=>{a.value&&(i?(n=a.value.style.transform,a.value.style.transform=""):a.value.style.transform=n)}),we(()=>{t.modelValue&&(v.value=!0,P.value=!0,ce())}),{afterEnter:Y,afterLeave:F,beforeLeave:ee,handleClose:ue,onModalClick:de,close:m,doClose:ye,onOpenAutoFocus:Ee,onCloseAutoFocus:c,onCloseRequested:g,onFocusoutPrevented:e,titleId:w,bodyId:r,closed:C,style:E,overlayDialogStyle:te,rendered:P,visible:v,zIndex:_,transitionConfig:Q,_draggable:x,_alignCenter:j,_overflow:H}},rl=B({name:"ElDialog",inheritAttrs:!1}),cl=B({...rl,props:nl,emits:sl,setup(t,{expose:a}){const l=t,f=Bt();Xe({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},S(()=>!!f.title));const o=re("dialog"),d=L(),n=L(),w=L(),{visible:r,titleId:v,bodyId:C,style:P,overlayDialogStyle:_,rendered:u,transitionConfig:O,zIndex:R,_draggable:N,_alignCenter:D,_overflow:E,handleClose:x,onModalClick:j,onOpenAutoFocus:H,onCloseAutoFocus:te,onCloseRequested:Q,onFocusoutPrevented:Y}=il(l,d);Je(lt,{dialogRef:d,headerRef:n,bodyId:C,ns:o,rendered:u,style:P});const F=tt(j),ee=S(()=>l.modalPenetrable&&!l.modal&&!l.fullscreen);return a({visible:r,dialogContentRef:w,resetPosition:()=>{var m;(m=w.value)==null||m.resetPosition()},handleClose:x}),(m,ue)=>(b(),X(s(mt),{to:m.appendTo,disabled:m.appendTo!=="body"?!1:!m.appendToBody},{default:y(()=>[h(Nt,xe(s(O),{persisted:""}),{default:y(()=>{var de;return[Ft(h(s(Jt),{"custom-mask-event":"",mask:m.modal,"overlay-class":[(de=m.modalClass)!=null?de:"",`${s(o).namespace.value}-modal-dialog`,s(o).is("penetrable",s(ee))],"z-index":s(R)},{default:y(()=>[k("div",{role:"dialog","aria-modal":"true","aria-label":m.title||void 0,"aria-labelledby":m.title?void 0:s(v),"aria-describedby":s(C),class:A(`${s(o).namespace.value}-overlay-dialog`),style:Ce(s(_)),onClick:s(F).onClick,onMousedown:s(F).onMousedown,onMouseup:s(F).onMouseup},[h(s(vt),{loop:"",trapped:s(r),"focus-start-el":"container",onFocusAfterTrapped:s(H),onFocusAfterReleased:s(te),onFocusoutPrevented:s(Y),onReleaseRequested:s(Q)},{default:y(()=>[s(u)?(b(),X(ol,xe({key:0,ref_key:"dialogContentRef",ref:w},m.$attrs,{center:m.center,"align-center":s(D),"close-icon":m.closeIcon,draggable:s(N),overflow:s(E),fullscreen:m.fullscreen,"header-class":m.headerClass,"body-class":m.bodyClass,"footer-class":m.footerClass,"show-close":m.showClose,title:m.title,"aria-level":m.headerAriaLevel,onClose:s(x)}),zt({header:y(()=>[m.$slots.title?V(m.$slots,"title",{key:1}):V(m.$slots,"header",{key:0,close:s(x),titleId:s(v),titleClass:s(o).e("title")})]),default:y(()=>[V(m.$slots,"default")]),_:2},[m.$slots.footer?{name:"footer",fn:y(()=>[V(m.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","header-class","body-class","footer-class","show-close","title","aria-level","onClose"])):Z("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,["aria-label","aria-labelledby","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["mask","overlay-class","z-index"]),[[Vt,s(r)]])]}),_:3},16)]),_:3},8,["to","disabled"]))}});var ul=pe(cl,[["__file","dialog.vue"]]);const dl=_e(ul),fl=ie({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},contentPosition:{type:String,values:["left","center","right"],default:"center"},borderStyle:{type:J(String),default:"solid"}}),vl=B({name:"ElDivider"}),ml=B({...vl,props:fl,setup(t){const a=t,l=re("divider"),f=S(()=>l.cssVar({"border-style":a.borderStyle}));return(o,d)=>(b(),T("div",{class:A([s(l).b(),s(l).m(o.direction)]),style:Ce(s(f)),role:"separator"},[o.$slots.default&&o.direction!=="vertical"?(b(),T("div",{key:0,class:A([s(l).e("text"),s(l).is(o.contentPosition)])},[V(o.$slots,"default")],2)):Z("v-if",!0)],6))}});var gl=pe(ml,[["__file","divider.vue"]]);const pl=_e(gl),yl=ie({type:{type:String,values:["primary","success","warning","info","danger","default"],default:void 0},underline:{type:[Boolean,String],values:[!0,!1,"always","never","hover"],default:void 0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:je}}),hl={click:t=>t instanceof MouseEvent},bl=B({name:"ElLink"}),_l=B({...bl,props:yl,emits:hl,setup(t,{emit:a}){const l=t,f=We("link");Xe({scope:"el-link",from:"The underline option (boolean)",replacement:"'always' | 'hover' | 'never'",version:"3.0.0",ref:"https://element-plus.org/en-US/component/link.html#underline"},S(()=>Te(l.underline)));const o=re("link"),d=S(()=>{var r,v,C;return[o.b(),o.m((C=(v=l.type)!=null?v:(r=f.value)==null?void 0:r.type)!=null?C:"default"),o.is("disabled",l.disabled),o.is("underline",n.value==="always"),o.is("hover-underline",n.value==="hover"&&!l.disabled)]}),n=S(()=>{var r,v,C;return Te(l.underline)?l.underline?"hover":"never":(C=(v=l.underline)!=null?v:(r=f.value)==null?void 0:r.underline)!=null?C:"hover"});function w(r){l.disabled||a("click",r)}return(r,v)=>(b(),T("a",{class:A(s(d)),href:r.disabled||!r.href?void 0:r.href,target:r.disabled||!r.href?void 0:r.target,onClick:w},[r.icon?(b(),X(s(Ae),{key:0},{default:y(()=>[(b(),X(Ie(r.icon)))]),_:1})):Z("v-if",!0),r.$slots.default?(b(),T("span",{key:1,class:A(s(o).e("inner"))},[V(r.$slots,"default")],2)):Z("v-if",!0),r.$slots.icon?V(r.$slots,"icon",{key:2}):Z("v-if",!0)],10,["href","target"]))}});var Cl=pe(_l,[["__file","link.vue"]]);const kl=_e(Cl),wl=["start","center","end","space-around","space-between","space-evenly"],Il=["top","middle","bottom"],El=ie({tag:{type:String,default:"div"},gutter:{type:Number,default:0},justify:{type:String,values:wl,default:"start"},align:{type:String,values:Il}}),Sl=B({name:"ElRow"}),Ll=B({...Sl,props:El,setup(t){const a=t,l=re("row"),f=S(()=>a.gutter);Je(et,{gutter:f});const o=S(()=>{const n={};return a.gutter&&(n.marginRight=n.marginLeft=`-${a.gutter/2}px`),n}),d=S(()=>[l.b(),l.is(`justify-${a.justify}`,a.justify!=="start"),l.is(`align-${a.align}`,!!a.align)]);return(n,w)=>(b(),X(Ie(n.tag),{class:A(s(d)),style:Ce(s(o))},{default:y(()=>[V(n.$slots,"default")]),_:3},8,["class","style"]))}});var $l=pe(Ll,[["__file","row.vue"]]);const Tl=_e($l),W=Rt([{name:"每行6张",num:6},{name:"每行7张",num:7},{name:"每行8张",num:8},{name:"每行9张",num:9},{name:"每行10张",num:10},{name:"每行11张",num:11},{name:"每行12张",num:12}]),Pl={key:0},Ml={class:"image-item"},Dl={key:0,style:{"text-align":"center",padding:"10px",color:"#909399"}},Ol={key:1,style:{"text-align":"center"}},Al=B({__name:"ImageView",props:{ImageInfo:{},total:{}},setup(t,{expose:a}){const l=L([]);let f=null;const o=d=>{f&&clearTimeout(f),f=setTimeout(()=>{const n=l.value.indexOf(d);n>-1?l.value.splice(n,1):l.value.push(d),f=null},50)};return a({checkList:l}),Ze(()=>{f&&clearTimeout(f)}),(d,n)=>{const w=bt,r=Ye,v=Kt,C=Tl,P=ht;return b(),T("div",null,[d.ImageInfo.length!=0?(b(),T("div",Pl,[h(P,{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=_=>l.value=_)},{default:y(()=>[h(C,{gutter:[12,12]},{default:y(()=>[(b(!0),T(De,null,Oe(d.ImageInfo,_=>(b(),X(v,{xs:12,sm:8,md:6,key:_.id},{default:y(()=>[k("div",Ml,[h(w,{label:_.id,class:"custom-checkbox"},null,8,["label"]),h(r,{onClick:u=>o(_.id),src:_.data,fit:"contain",class:A([{"selected-image":l.value.includes(_.id)},"image-content"]),"hide-on-click-modal":"","preview-teleported":"",lazy:""},null,8,["onClick","src","class"])])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]),d.total&&d.ImageInfo.length<d.total?(b(),T("div",Dl," 已显示 "+me(d.ImageInfo.length)+" / "+me(d.total)+" 张图片 ",1)):Z("",!0)])):(b(),T("div",Ol,[...n[1]||(n[1]=[k("h3",null,"当前选项下暂无图片",-1)])]))])}}}),Bl=Qe(Al,[["__scopeId","data-v-ea8956c8"]]),Nl={class:"main-container"},Fl={class:"left-panel"},zl={class:"card-header"},Vl={class:"count-number"},Rl={class:"action-bar"},xl={class:"button-group"},Ul={key:0,class:"loading-more"},jl={key:1,class:"load-complete"},Hl={class:"right-panel"},Yl={class:"selected-list-container"},Kl={key:0,class:"empty-state"},Wl={key:1,class:"selected-items"},Xl={class:"selected-item"},ql={class:"drag-handle"},Gl={class:"image-name"},Jl={class:"stitching-controls"},Zl={class:"result-container"},Ql={id:"canvas",ref:"canvas",width:"1",height:"1",style:{display:"none"}},eo={key:1,class:"no-result"},to=B({__name:"ImageStitching",setup(t){const a=L([]),l=L([]),f=L(""),o=L([]),d=L(20),n=L(1),w=L(!1),r=S(()=>{const e=(n.value-1)*d.value+d.value;return o.value.slice(0,e)}),v=c=>{const e=c.target;e.scrollHeight-e.scrollTop<=e.clientHeight+100&&C()},C=()=>{w.value||r.value.length>=o.value.length||(w.value=!0,setTimeout(()=>{n.value+=1,w.value=!1},200))};ge(o,()=>{n.value=1}),we(async()=>{await kt(),await wt(),a.value=Re.map((c,e)=>({value:e.toString(),label:c})),l.value=a.value,l.value.length>0&&l.value[0]&&(f.value=l.value[0].value,_(f.value))});const P=c=>{const e=parseInt(c);if(e===0)return ve.value;const g=Re[e];return ve.value.filter(i=>i.type===g)},_=c=>{const e=P(c);o.value=e},u=L(null),O=()=>{if(u.value&&o.value){const c=new Set(u.value.checkList||[]);o.value.map(g=>g.id).forEach(g=>{c.add(g)}),u.value.checkList=Array.from(c)}},R=()=>{if(u.value&&o.value){const c=new Set(u.value.checkList||[]);new Set(o.value.map(g=>g.id)).forEach(g=>{c.has(g)?c.delete(g):c.add(g)}),u.value.checkList=Array.from(c)}},N=()=>{if(u.value&&o.value){const c=new Set(u.value.checkList||[]);new Set(o.value.map(g=>g.id)).forEach(g=>{c.delete(g)}),u.value.checkList=Array.from(c)}},D=L(!0),E=c=>{console.log("List changed:",c)},x=c=>ve.value.find(g=>g.id===c)?.name||"未知",j=c=>{if(!u.value||!u.value.checkList||c<0||c>=u.value.checkList.length)return;const e=u.value.checkList[c];u.value.checkList.splice(c,1);const g=u.value.checkList.indexOf(e);g!==-1&&u.value.checkList.splice(g,1)},H=L(W[0]?.name),te=L([]);we(()=>{te.value=[...W]});const Q=L(!1),Y=L(""),F=new Map,ee=c=>{if(F.has(c))return F.get(c);const e=ve.value.find(g=>g.id===c);return e?.data?(F.set(c,e.data),e.data):""},ce=()=>{F.clear()};ge(o,ce);let m=null;const ue=async()=>{m&&m.abort(),m=new AbortController,Q.value=!0,await Ge();try{await de(m.signal)}catch(c){c.name!=="AbortError"&&console.error("图片拼接失败:",c)}},de=async c=>{if(c?.aborted)return;const e=document.getElementById("canvas");if(!e)return;const g=e.getContext("2d");if(g)try{if(c?.aborted)return;const i=window.devicePixelRatio||1,p=u?.value?.checkList||[],M=[];for(const $ of p){const oe=ve.value.find(ne=>ne.id===$);oe&&M.push(oe)}const z=M.slice(0,100).map($=>$.data),K=await Promise.all(z.map($=>ye($))),U=ke(),I=K.length;if(I===0)return;let q=0;for(let $=0;$<I;$+=U){const ne=K.slice($,$+U).reduce((fe,se)=>fe+se.naturalWidth,0);ne>q&&(q=ne)}let le=0;for(let $=0;$<I;$+=U){const oe=K.slice($,$+U),ne=Math.max(...oe.map(fe=>fe.naturalHeight));le+=ne}e.style.width=q+"px",e.style.height=le+"px",e.width=q*i,e.height=le*i,g.scale(i,i),g.fillStyle="#fff",g.fillRect(0,0,q,le);let Be=0;for(let $=0;$<I;$+=U){const oe=K.slice($,$+U),ne=Math.max(...oe.map(se=>se.naturalHeight));let fe=0;for(const se of oe)g.drawImage(se,fe,Be,se.naturalWidth,se.naturalHeight),fe+=se.naturalWidth;Be+=ne}Y.value=e.toDataURL("image/png")}catch(i){console.error("图片加载失败:",i)}},ke=()=>{if(!W[0])return 0;if(!H.value)return W&&W.length>0?W[0].num:6;const c=W.find(e=>e.name===H.value);return c?c.num:W&&W.length>0?W[0].num:6},ye=c=>new Promise((e,g)=>{const i=new Image;i.onload=()=>e(i),i.onerror=g,i.src=c}),Ee=c=>{if(!u.value?.checkList)return[];const e=u.value.checkList.indexOf(c);return e===-1?[]:[...u.value.checkList.slice(e),...u.value.checkList.slice(0,e)].map(i=>ve.value.find(M=>M.id===i)?.data||"").filter(i=>i!=="")};return Ze(()=>{m&&m.abort(),ce()}),(c,e)=>{const g=Et,i=It,p=St,M=Ae,ae=pl,he=kl,z=Lt,K=Ye,U=dl;return b(),T("div",Nl,[k("div",Fl,[h(z,{shadow:"hover",class:"flex-card"},{header:y(()=>[k("div",zl,[h(i,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=I=>f.value=I),placeholder:"请选择",size:"large",onChange:_,class:"category-select"},{default:y(()=>[(b(!0),T(De,null,Oe(l.value,I=>(b(),X(g,{key:I.value,label:I.label,value:I.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),h(p,{link:"",type:"text",class:"image-count"},{default:y(()=>[e[5]||(e[5]=G(" 当前分类下共有",-1)),k("span",Vl,me(o.value.length),1),e[6]||(e[6]=G("张图片 ",-1))]),_:1})]),k("div",null,[h(ae,null,{default:y(()=>[h(M,null,{default:y(()=>[h(s(pt))]),_:1})]),_:1})]),k("div",Rl,[h(he,{underline:!1,class:"hint-text"},{default:y(()=>[e[7]||(e[7]=G(" 温馨提示：点击图片即可选中，当前共选择 ",-1)),h(he,{type:"primary",underline:!1,class:"selected-count"},{default:y(()=>[G(me(u.value?.checkList?.length||0),1)]),_:1}),e[8]||(e[8]=G(" 张图片。 ",-1))]),_:1}),k("div",xl,[h(p,{type:"primary",round:"",plain:"",onClick:O,size:"small"},{default:y(()=>[...e[9]||(e[9]=[G("全选",-1)])]),_:1}),h(p,{type:"success",round:"",plain:"",onClick:R,size:"small"},{default:y(()=>[...e[10]||(e[10]=[G("反选",-1)])]),_:1}),h(p,{type:"danger",round:"",plain:"",onClick:N,size:"small"},{default:y(()=>[...e[11]||(e[11]=[G("清空",-1)])]),_:1})])])]),default:y(()=>[k("div",{class:"image-grid-container",onScroll:v},[h(Bl,{ref_key:"List",ref:u,ImageInfo:r.value,total:o.value.length},null,8,["ImageInfo","total"]),w.value?(b(),T("div",Ul,[h(M,{class:"is-loading"},{default:y(()=>[h(s(gt))]),_:1}),e[12]||(e[12]=G(" 加载中... ",-1))])):Z("",!0),r.value.length>=o.value.length&&o.value.length>0?(b(),T("div",jl," 已加载全部图片 ")):Z("",!0)],32)]),_:1})]),k("div",Hl,[h(z,{shadow:"hover",class:"flex-card selected-panel"},{header:y(()=>[...e[13]||(e[13]=[k("div",{class:"panel-header"},[k("span",{class:"panel-title"},"已选择的图片")],-1),k("div",{class:"panel-subtitle"},"拖拽图片可调整顺序,点击缩略图可查看预览",-1)])]),footer:y(()=>[k("div",Jl,[h(i,{modelValue:H.value,"onUpdate:modelValue":e[3]||(e[3]=I=>H.value=I),clearable:"",placeholder:"请选择拼接方式",class:"stitching-select"},{default:y(()=>[(b(!0),T(De,null,Oe(s(W),I=>(b(),X(g,{key:I.name,label:I.name,value:I.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),h(p,{disabled:u.value?.checkList.length==0,onClick:ue,type:"primary",round:"",class:"generate-btn"},{default:y(()=>[...e[15]||(e[15]=[G("生成拼接图",-1)])]),_:1},8,["disabled"])])]),default:y(()=>[k("div",Yl,[u.value?.checkList?.length===0?(b(),T("div",Kl,[...e[14]||(e[14]=[k("h3",null,"当前未选择任何图片",-1)])])):(b(),T("div",Wl,[h(s(xt),{onChange:E,list:u.value?.checkList,"ghost-class":"ghost","chosen-class":"chosenClass",animation:"300",onStart:e[1]||(e[1]=I=>D.value=!0),onEnd:e[2]||(e[2]=I=>D.value=!1),"item-key":"id"},{item:y(({element:I,index:q})=>[k("div",Xl,[k("li",null,[k("span",ql,[h(K,{class:"thumbnail",src:ee(I),"preview-src-list":Ee(I),fit:"cover","hide-on-click-modal":"","preview-teleported":"",lazy:""},null,8,["src","preview-src-list"])]),k("span",Gl,me(x(I)),1),h(p,{onClick:le=>j(q),text:"",type:"danger",icon:s(yt),circle:"",size:"small",class:"delete-btn"},null,8,["onClick","icon"])])])]),_:1},8,["list"])]))])]),_:1})]),k("div",null,[h(U,{modelValue:Q.value,"onUpdate:modelValue":e[4]||(e[4]=I=>Q.value=I),title:"拼接结果",width:"75%",draggable:"",class:"result-dialog"},{default:y(()=>[h(ae),k("div",Zl,[k("canvas",Ql,null,512),Y.value?(b(),X(K,{key:0,src:Y.value,fit:"contain",class:"result-image","preview-src-list":[Y.value],"hide-on-click-modal":"","preview-teleported":"",lazy:""},null,8,["src","preview-src-list"])):(b(),T("div",eo,[...e[16]||(e[16]=[k("p",null,"请先生成拼接图",-1)])]))])]),_:1},8,["modelValue"])])])}}}),ao=Qe(to,[["__scopeId","data-v-c6c24e38"]]);export{ao as default};
